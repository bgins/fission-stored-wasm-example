<!doctype html>

<html>
  <head>
    <script defer type="module" src="main.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Karla&family=Work+Sans&display=swap" rel="stylesheet">
    <link href="main.css" rel="stylesheet"></link>
    <style>
      body {
        background-color: #fefdff;
        font-family: 'Karla', sans-serif;
      }
      h1, h2 {
        font-family: 'Work Sans', sans-serif;
      }
      code, pre {
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <div class="flex flex-column pa3 mw7 center">
      <div class="flex justify-center">
        <h1>Storing Functions to Web Native Storage</h1>
      </div>
      <div>
        <p class="f4 lh-copy">
          This example demonstrates how to store WebAssembly modules in web native storage and 
          execute them at a later time. We have compiled an
          <code class="pa1 bg-near-white">add</code> function from C to WebAssembly.
        </p>
      </div>
      <div class="flex bg-near-white">
  <pre class="f4 lh-copy courier">
  int add(int x, int y)
  {
    return x + y;
  }</pre>
      </div>
      <div>
        <p class="f4 lh-copy">
          Our 
          <a class="link underline-hover dark-blue" href="https://guide.fission.codes/">
            Storing WebAssembly Modules guide
          </a> 
          walks through this example in depth and you can also check out the 
          <a class="link underline-hover dark-blue" href="https://github.com/bgins/fission-stored-wasm-example">
            source code
          </a> 
          on GitHub.
        </p>
      </div>
      <div id="auth" class="dn">
        <div>
          <div>
            <div class="f4 lh-copy">
              We will use web native storage in your browser for this example. Please authenticate with 
              Fission to get started.
            </div>
          </div>
          <div class="flex justify-center">
            <div class="pa4">
              <button id="auth-button" class="f6 link dim br3 ph3 pv2 mb2 dib white bg-purple">
                Authenticate with Fission
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="store" class="dn">
        <div>
          <div class="flex justify-center">
            <h2>Request and Store</h2>
          </div>
          <div>
            <div class="f4 lh-copy">
              Let's start off by requesting 
              <code class="pa1 bg-near-white">add.wasm</code> and storing
              it to web native storage. We will make a GET request, convert the 
              <code class="pa1 bg-near-white">Response</code> to an 
              <code class="pa1 bg-near-white">ArrayBuffer</code>, 
              and then store it as a <code class="pa1 bg-near-white">Blob</code>.
            </div>
          </div>
          <div id="store-button-row" class="flex justify-center">
            <div class="pa4">
              <button id="store-button" class="f6 link dim br3 ph3 pv2 mb2 dib white bg-purple">
                Request and Store
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="list" class="dn">
        <div>
          <div class="flex justify-center">
            <h2>List Storage</h2>
          </div>
          <div>
            <div class="f4 lh-copy">
              We have stored <code class="pa1 bg-near-white">add.wasm</code> to the 
              <code class="pa1 bg-near-white">wasm/math</code> directory in web native app storage.
              Let's check to make sure it is there.
            </div>
          </div>
          <div id="list-button-row" class="flex justify-center">
            <div class="pa4">
              <button id="list-button" class="f6 link dim br3 ph3 pv2 mb2 dib white bg-purple">
                List directory contents
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="contents" class="dn">
        <div>
          <div class="flex justify-center overflow-auto">
            <table class="f6 w-100 pa4 mw8" cellspacing="0">
              <thead>
                <tr>
                  <th class="fw6 bb b--black-20 tl pb3 pr3 bg-white">name</th>
                  <th class="fw6 bb b--black-20 tl pb3 pr3 bg-white">size</th>
                  <th class="fw6 bb b--black-20 tl pb3 pr3 bg-white">mtime</th>
                  <th class="fw6 bb b--black-20 tl pb3 pr3 bg-white">isFile</th>
                </tr>
              </thead>
              <tbody id="directory-listing" class="lh-copy">
              </tbody>
            </table>
          </div>
          <div>
            <div class="f4 lh-copy">
              It worked! Files are stored in web native storage with their name, size, last 
              modified time and flag that indicates whether they are a file or not.
            </div>
          </div>
          <div id="show-run-button-row" class="flex justify-center">
            <div class="pa4">
              <button id="show-run-button" class="f6 link dim br3 ph3 pv2 mb2 dib white bg-purple">
                Next
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="run" class="dn">
        <div>
          <div class="flex justify-center">
            <h2>Load and Run</h2>
          </div>
          <div>
            <div class="f4 lh-copy">
              We can now load our module from storage and ask it to add some numbers!
            </div>
          </div>
          <div class="flex pa4 justify-center">
            <input id="lhs" class="ph2 input-reset ba bg-transparent w-20" type="text">
            <div class="pa3">+</div>
            <input id="rhs" class="ph2 input-reset ba bg-transparent w-20" type="text">
            <div class="pa3">=</div>
            <div id="result" class="pv3"></div>
            <button id="add-button" class="f6 link dim br3 ph3 pv2 ml4 mv2 dib white bg-purple">
              Add
            </button>
            <button id="clear-button" class="f6 link dim br3 ph3 pv2 ml3 mv2 dib white bg-purple">
              Clear
            </button>
          </div>
          <div>
            <div class="f4 lh-copy">
              The module is loaded as an 
              <code class="pa1 bg-near-white">ArrayBuffer</code> and instantiated as a  
              <code class="pa1 bg-near-white">ResultObject</code> with a module and instance. We 
              call the <code class="pa1 bg-near-white">add</code> function off the instance and 
              display the result.
            </div>
          </div>
        </div>
      </div>
      <div id="everywhere" class="dn">
        <div>
          <div class="flex justify-center">
            <h2>Your Maths are Everywhere</h2>
          </div>
          <div>
            <div class="f4 lh-copy">
              We have published the stored module and the result of your computation to web native 
              storage across the web. If you have authenticated your Fission account on another 
              device, you can open this example and see the results there.
            </div>
          </div>
          <div class="pt3">
            <div class="f4 lh-copy">
              If you are a new Fission user, you can authenticate on another device by following 
              the instructions in our 
              <a class="link underline-hover dark-blue" href="https://guide.fission.codes/hosting/account-linking">
                Account Linking guide
              </a>.
            </div>
          </div>
          <div class="pt3">
            <div class="f4 lh-copy">
              Thank you trying this example! We are super excited about the future of web native compute,
              and we look forward to the amazing things you might build WebAssembly and stored functions.
              Check out our 
              <a class="link underline-hover dark-blue" href="https://guide.fission.codes/webnative-sdk/web-native-introduction">
                Web Native Introduction
              </a>
              to learn more about web native and the future of computing beyond the edge.
            </div>
          </div>
          <div class="flex justify-center">
            <div class="pa4">
              <button id="reset-button" class="f6 link dim br3 ph3 pv2 mb2 dib white bg-purple">
                Reset this example
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>